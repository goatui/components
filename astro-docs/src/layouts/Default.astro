---
interface Props {
  title?: string;
  description?: string;
  root?: boolean;
  keywords?: string;
  classes?: string;
}

const { title, root, description, keywords, classes } = Astro.props;

import Layout from './Base.astro';
import site from '../_data/site.json';
import componentsDetails from '../_data/componentsDetails.json';

const getTitle = (root?: boolean) => {
  return (!root) ? title : '';
};
---

<Layout title={title} description={description} keywords={keywords}>

  <nav class='top-nav'>
    <goat-header color='custom-01' class={`actions-separated ${!root ? 'border' : ''}`}>
      <div slot='left'>
        <goat-header-brand logo='/assets/img/logo.svg' href='/#' name={site.title}
                           sub-title={getTitle(root)}></goat-header-brand>
      </div>

      <div slot='right'>

        {!root &&
          (
            <goat-select id='site-search'
                         class='hide-tablet-portrait-below'
                         search='contains'
                         layer='01'
                         hide-dropdown-icon
                         placeholder="Type '/' for search">
              <goat-icon slot='start' name='search' size='1rem'></goat-icon>
            </goat-select>
          )
        }


        <goat-header-action
          class='hide-tablet-portrait-below'
          href='/components#'>
          Components
        </goat-header-action>

        <goat-header-action
          class='hide-tablet-portrait-below'
          href='/blog#'>
          Blog
        </goat-header-action>

        <goat-button
          color='brand-primary'
          size='sm'
          kind='simple'
          target='_blank'
          class='hide-tablet-portrait-below sponsor-btn'
          href='https://github.com/sponsors/shivajivarma'>
          Sponsor
        </goat-button>

        <goat-divider class='header-divider hide-tablet-portrait-below' vertical></goat-divider>

        <goat-header-action
          class='dir-switcher hide-tablet-portrait-below'
          aria-label='Direction switcher'
        >LTR</goat-header-action>

        <goat-header-action
          id='theme-switcher'
          icon='sun'
          class='theme-switcher'
          aria-label='Theme switcher'></goat-header-action>

        <goat-header-action
          icon='logo--github'
          aria-label='View Github'
          href={`https://github.com/${site.github_username}/${site.github_project}`}
          target='_blank'
        ></goat-header-action>

        <goat-header-action
          class='show-tablet-portrait-below'
          aria-label='Menu'
          id="header-menu-btn"
          icon='menu'></goat-header-action>
      </div>



    </goat-header>

  </nav>

  <div id="header-menu">
    <div class='header-menu-head'>
      <goat-button id='header-menu-close-btn' variant='ghost' icon='close--large' color='dark' dark-mode-color='light'></goat-button>
    </div>

    <goat-button  href='/components#' kind='block' variant='ghost' color='dark' dark-mode-color='light'>
      <goat-icon name='roadmap'></goat-icon>&nbsp;
      Components
    </goat-button>
    <goat-button href='/blog#' kind='block' variant='ghost' color='dark' dark-mode-color='light'>
      <goat-icon name='blog'></goat-icon>&nbsp;
      Blog
    </goat-button>
    <goat-button href='https://github.com/sponsors/shivajivarma' kind='block' variant='ghost' color='dark' dark-mode-color='light'>
      <goat-icon name='currency--rupee'></goat-icon>&nbsp;
      Sponsor
    </goat-button>
  </div>

  <main class={classes}>

    <slot />
  </main>

  <script is:inline define:vars={{ componentsDetails }}>
    document.addEventListener('DOMContentLoaded', function() {
      const search = document.querySelector('#site-search');

      if (search) {
        // prettier-ignore
        search.items = componentsDetails.components.map(component => ({
          label: component.metadata.name,
          value: component.tag.replace('goat-', ''),
        }));
        search.items = search.items.filter(item => !!item.label);
        search.addEventListener('goat:change', function(e) {
          window.location.href = '/components/' + e.detail.value;
        });

        search.addEventListener('goat:search-enter', function(e) {
          if (e.detail.currentItems.length > 0)
            window.location.href = '/components/' + e.detail.currentItems[0].value;
        });

        document.addEventListener('keydown', function(e) {
          if (e.key === '/') {
            e.preventDefault();
            search.open = true;
            setTimeout(() => {
              search.setFocus();
            }, 300);
          }
        });
      }
    });
  </script>
</Layout>
