---
interface Props {
  title?: string;
  description?: string;
  root?: boolean;
  keywords?: string;
  classes?: string;
}

const { title, root, description, keywords, classes } = Astro.props;

import Layout from './Base.astro';
import site from '../_data/site.json';
import componentsDetails from '../_data/componentsDetails.json';

const getTitle = (root?: boolean) => {
  return (!root) ? title : '';
};
---

<Layout title={title} description={description} keywords={keywords}>

  <nav class='top-nav'>
    <goat-header color='custom-01' class={`actions-separated ${!root ? 'border' : ''}`}>
      <div slot='left'>
        <goat-header-brand logo='/assets/img/logo.svg' href='/#' name={site.title}
                           sub-title={getTitle(root)}></goat-header-brand>
      </div>

      <div slot='right'>

        {!root &&
          (
            <goat-select id='site-search'
                         class='hide-mobile'
                         search='contains'
                         layer='01'
                         hide-dropdown-icon
                         placeholder="Type '/' for search">
              <goat-icon slot='start' name='search' size='1rem'></goat-icon>
            </goat-select>
          )
        }


        <!-- <goat-header-action id='dir-switcher' class='hide-tablet-landscape-below'>LTR</goat-header-action>
 -->
        <goat-header-action
          class='hide-mobile'
          href='/components#'>
          Components
        </goat-header-action>

        <goat-header-action
          class='hide-mobile'
          href='/blog#'>
          Blog
        </goat-header-action>

        <goat-button
          color='brand-primary'
          size='sm'
          kind='simple'
          target='_blank'
          class='hide-mobile sponsor-btn'
          href='https://github.com/sponsors/shivajivarma'>
          Sponsor
        </goat-button>

        <goat-divider class='header-divider hide-mobile' vertical></goat-divider>

        <goat-header-action
          id='theme-switcher'
          icon='sun'
          class='theme-switcher'
          aria-label='Theme switcher'></goat-header-action>

        <goat-header-action
          icon='logo--github'
          aria-label='View Github'
          href={`https://github.com/${site.github_username}/${site.github_project}`}
          target='_blank'
        ></goat-header-action>

        <goat-header-action
          class='show-mobile'
          dropdown-target='data-dropdown'
          aria-label='Menu'
          icon='menu'></goat-header-action>

        <goat-dropdown id='data-dropdown'>
          <goat-menu slot='dropdown-content' class='menu' style='width: 200px'>
            <goat-menu-item href='/components#'>
              <goat-icon name='roadmap' slot='start'></goat-icon>
              Components
            </goat-menu-item>
            <goat-menu-item href='/blog#'>
              <goat-icon name='blog' slot='start'></goat-icon>
              Blog
            </goat-menu-item>
            <goat-divider></goat-divider>
            <goat-menu-item href='https://github.com/sponsors/shivajivarma'>
              <goat-icon name='currency--rupee' slot='start'></goat-icon>
              Sponsor
            </goat-menu-item>
          </goat-menu>
        </goat-dropdown>
      </div>

    </goat-header>

  </nav>

  <main class={classes}>
    <slot />
  </main>

  <script is:inline define:vars={{ componentsDetails }}>
    document.addEventListener('DOMContentLoaded', function() {
      const search = document.querySelector('#site-search');

      // prettier-ignore
      search.items = componentsDetails.components.map(component => ({
        label: component.metadata.name,
        value: component.tag.replace('goat-', ''),
      }));
      search.items = search.items.filter(item => !!item.label);
      search.addEventListener('goat:change', function(e) {
        window.location.href = '/components/' + e.detail.value;
      });

      search.addEventListener('goat:search-enter', function(e) {
        if (e.detail.currentItems.length > 0)
          window.location.href = '/components/' + e.detail.currentItems[0].value;
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === '/') {
          e.preventDefault();
          search.open = true;
          setTimeout(() => {
            search.setFocus();
          }, 300);
        }
      });
    });
  </script>
</Layout>
